- name: requirements packages
  yum:
    name:
      - yum-utils
      - device-mapper-persistent-data
      - lvm2
      - java-1.8.0
      - git
      - docker

- name: remove the java-7
  yum:
    name: java-1.7.0-openjdk
    state: absent

- name: create user jenkins
  user:
    name: jenkins
    home: /var/lib/jenkins
    groups: docker,root
    append: yes
    generate_ssh_key: yes
    ssh_key_bits: 2048

- name: set ownership jenkins home
  file:
    path: /var/lib/jenkins
    owner: jenkins
    group: jenkins
    mode: 0755

- name: add the user 'root' to 'docker' group
  user:
    name: root
    groups: docker
    append: yes

- name: add the user 'jenkins' to 'docker' group
  user:
    name: jenkins
    groups: docker
    append: yes

- name: install awscli and docker-compose
  pip: name={{ item }}
  with_items:
    - awscli
    - docker-compose

- name: symlink docker-compose
  file:
    src: /usr/local/bin/docker-compose
    dest: /usr/bin/docker-compose
    owner: root
    group: root
    state: link
  
- name: chkconfig docker
  service:
    name: docker
    enabled: yes